<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-90554780-6', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Content Security Policy (CSP) 筆記 | EOTONES Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Content Security Policy (CSP) 內容安全政策 Content Security Policy是寫給瀏覽器看的 他寫在從伺服端回應給使用者瀏覽器端網頁的HTTP Header裡 主要用來限制網頁中對外部的請求來源(例如:css,js(ajax,ws),webfont,img,video,iframe等等) 還有一部份是禁止HTML行內的JS或CSS運作 以及限制&amp;lt;f">
<meta name="keywords" content="Security,HTTP Header">
<meta property="og:type" content="article">
<meta property="og:title" content="Content Security Policy (CSP) 筆記">
<meta property="og:url" content="https://eotones.github.io/Web-security/Content-Security-Policy-CSP.html">
<meta property="og:site_name" content="EOTONES Blog">
<meta property="og:description" content="Content Security Policy (CSP) 內容安全政策 Content Security Policy是寫給瀏覽器看的 他寫在從伺服端回應給使用者瀏覽器端網頁的HTTP Header裡 主要用來限制網頁中對外部的請求來源(例如:css,js(ajax,ws),webfont,img,video,iframe等等) 還有一部份是禁止HTML行內的JS或CSS運作 以及限制&amp;lt;f">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2019-07-31T10:13:59.305Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Content Security Policy (CSP) 筆記">
<meta name="twitter:description" content="Content Security Policy (CSP) 內容安全政策 Content Security Policy是寫給瀏覽器看的 他寫在從伺服端回應給使用者瀏覽器端網頁的HTTP Header裡 主要用來限制網頁中對外部的請求來源(例如:css,js(ajax,ws),webfont,img,video,iframe等等) 還有一部份是禁止HTML行內的JS或CSS運作 以及限制&amp;lt;f">
  
    <link rel="alternate" href="/atom.xml" title="EOTONES Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">EOTONES Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://eotones.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Content-Security-Policy-CSP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Web-security/Content-Security-Policy-CSP.html" class="article-date">
  <time datetime="2019-07-31T10:11:30.000Z" itemprop="datePublished">2019-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-security/">Web security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Content Security Policy (CSP) 筆記
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Content Security Policy (CSP) 內容安全政策</strong></p>
<p><strong>Content Security Policy</strong>是寫給<strong>瀏覽器</strong>看的<br>
他寫在從伺服端回應給使用者瀏覽器端網頁的<strong>HTTP Header</strong>裡<br>
主要用來<strong>限制</strong>網頁中對外部的請求來源(例如:css,js(ajax,ws),webfont,img,video,iframe等等)<br>
還有一部份是禁止HTML行內的JS或CSS運作<br>
以及限制<code>&lt;form&gt;</code>表單的指向網址</p>
<p>過濾XSS語法是伺服器端語言的工作(例如PHP)<br>
如果不幸過濾失敗的話<strong>CSP</strong>的功能可以<strong>阻止</strong>惡意語法在瀏覽器端運作<br>
算是多一道擋XSS的防線<br>
(要注意是規則要寫對才能起作用,寫法限制太寬鬆還是會阻止不了)</p>
<p>另外也要注意CSP白名單列入外部JS library CDN可能造成的風險<br>
除了要用<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener">SRI</a>檢查內容完整性避免被竄改之外<br>
還要注意這些library的安全性問題<br>
因為這些CDN含有大量開源的library,而且新舊版同時存在,若語法有安全問題則可能會被XSS語法引用來攻擊</p>
<ul>
<li>參考:
<ul>
<li><a href="https://blog.orange.tw/2019/03/a-wormable-xss-on-hackmd.html" target="_blank" rel="noopener">Orange: A Wormable XSS on HackMD!</a></li>
<li><a href="https://portswigger.net/blog/xss-without-html-client-side-template-injection-with-angularjs" target="_blank" rel="noopener">XSS without HTML: Client-Side Template Injection with AngularJS</a></li>
</ul>
</li>
</ul>
<p>還有Cookie在相同網域下(相同作用域)的所有網頁都能取得同樣的cookie,所以要把相同作用域網頁的CSP保持在一樣高的安全性設定,以防cookie被從CSP安全性比較低的網頁竊取走<br>
如果真的要在特定目錄降低CSP安全性設定的話<br>
另一種解決方式是用不同子網域來區隔開cookie的作用域</p>
<p>*如果可以的話建議將含有重要資訊的Cookie設為HttpOnly,這種狀態下瀏覽器端的JS就沒有權限存取cookie(方法請自行google)</p>
<div class="success">
<p>這篇只是挑重點寫的筆記,建議有看到任何不懂的東西就去google更詳細的資料來讀,<br>
還有至少要把MDN的資料讀過<br>
然後CSP也一直有在更新增加新語法,也建議常去關注新版本動態<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener">Content-Security-Policy - HTTP | MDN</a></p>
<p>更進階的話就是去讀CSP可能會被繞過的手法,來減少自己寫出的CSP語法產生漏洞的可能性(像是上面的例子)</p>
</div>
<h3 id="基本範例"><a class="header-anchor" href="#基本範例"></a>基本範例</h3>
<ul>
<li><strong>CSP</strong>可以完全限制外部連入的檔案和行內語法,這是預設全部阻擋的寫法(最安全):</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy: default-src &apos;none&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>或是以<strong>白名單</strong>的形式允許信任的外部來源:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy: default-src &apos;none&apos;; script-src &apos;self&apos; https://ajax.googleapis.com;</span><br></pre></td></tr></table></figure>
<p>建議可以先用瀏覽器的開發工具(F12)去看看Facebook和Twitter的<code>content-security-policy</code>寫法</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>Chrome瀏覽器開Twitter</span><br><span class="line"><span class="bullet">2. </span>F12 --&gt; Network --&gt; F5重新載入網頁 --&gt; </span><br><span class="line"><span class="bullet">3. </span>拉到最上面選取第一個載入的檔案(主網頁檔) --&gt; </span><br><span class="line"><span class="bullet">4. </span>Headers --&gt; Response Headers --&gt; content-security-policy</span><br></pre></td></tr></table></figure>
<h3 id="本頁主要資料來源"><a class="header-anchor" href="#本頁主要資料來源"></a>本頁主要資料來源:</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener">Content-Security-Policy - HTTP | MDN</a> - 這個很重要,建議看完</li>
<li><a href="https://en.wikipedia.org/wiki/Content_Security_Policy" target="_blank" rel="noopener">Content Security Policy - Wikipedia</a></li>
<li><a href="https://www.owasp.org/index.php/Content_Security_Policy_Cheat_Sheet" target="_blank" rel="noopener">Content Security Policy Cheat Sheet - OWASP</a></li>
<li><a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">CSP Evaluator</a> - Google提供的CSP檢測工具</li>
</ul>
<div class="warning">
<p>有實測一下<code>default-src 'none';</code>無法阻止Tampermomkey這類瀏覽器插件的腳本<br>
(以前運作方式不同似乎可以用CSP擋,但是現在實測過是無法阻擋了)<br>
也有一些瀏覽器插件可以直接停用CSP<br>
所以CSP的功能應該沒辦法拿來阻擋想用腳本修改網頁的人</p>
</div>
<h2 id="各語言寫法"><a class="header-anchor" href="#各語言寫法"></a>各語言寫法</h2>
<p>*根據MDN的資料說CSP HTTP Header語法如果重複出現,那麼效果會疊加並且採取最嚴格的設定(不過各家瀏覽器或是伺服器有沒有正確支援還是建議實測過比較安全)</p>
<h3 id="原始http-header"><a class="header-anchor" href="#原始http-header"></a>原始HTTP Header:</h3>
<p>HTTP Header是以換行當成區格,<br>
要注意所有<strong>CSP內容</strong>要輸出成<strong>同一行字串</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy: default-src &apos;none&apos;; img-src &apos;self&apos; data:;</span><br></pre></td></tr></table></figure>
<h3 id="apache-htaccess"><a class="header-anchor" href="#apache-htaccess"></a>Apache (.htaccess)</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> set Content-Security-Policy <span class="string">" \</span></span><br><span class="line"><span class="string">    default-src 'none'; \</span></span><br><span class="line"><span class="string">    img-src 'self' data:; \</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果子目錄要移除上層目錄的CSP規則可以用<code>Header unset</code>移除</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> unset Content-Security-Policy</span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="php"><a class="header-anchor" href="#php"></a>PHP</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Security-Policy: default-src 'none'; img-src 'self' data:;"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;test&lt;/p&gt;</span><br><span class="line">    &lt;img src=<span class="string">"example.jpg"</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="html"><a class="header-anchor" href="#html"></a>HTML</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;none&apos;; img-src &apos;self&apos; data:;&quot;&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;test&lt;/p&gt;</span><br><span class="line">    &lt;img src=&quot;example.jpg&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="指令-directives"><a class="header-anchor" href="#指令-directives"></a>指令 Directives</h2>
<ul>
<li><code>default-src</code> - <strong>預設值</strong>,以下種類未設定時會採用<code>default-src</code>的設定值
<ul>
<li>這個一定要設定以避免遺漏,至少要設定成<code>'none'</code>或<code>'self'</code></li>
</ul>
</li>
<li><code>img-src</code> - <code>&lt;img src=&quot;...&quot;&gt;</code></li>
<li><code>media-src</code> - <code>&lt;video&gt;</code> <code>&lt;audio&gt;</code> <code>&lt;source&gt;</code> <code>&lt;track&gt;</code></li>
<li><code>style-src</code> - <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</code></li>
<li><code>script-src</code> - <code>&lt;script&gt;</code></li>
<li><code>manifest-src</code> - <strong>icon圖標</strong> <code>&lt;link rel=&quot;manifest&quot; href=&quot;mainfest.json&quot;&gt;</code></li>
<li><code>object-src</code> - <code>&lt;object&gt;</code> <code>&lt;embed&gt;</code> <code>&lt;applet&gt;</code></li>
<li><code>frame-src</code> - <code>&lt;iframe&gt;</code></li>
<li><code>frame-ancestors</code> -  <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code>, or <code>&lt;applet&gt;</code></li>
<li><code>worker-src</code> - <code>Worker()</code></li>
<li><code>child-src</code> - <code>&lt;iframe&gt;</code> <code>Worker()</code> <em>已棄用,請改用上面兩個</em></li>
<li><code>form-action</code> - <code>&lt;form&gt;</code></li>
<li><code>font-src</code> - <code>@font-face</code></li>
<li><code>connect-src</code> - <code>XMLHttpRequest()</code> <code>WebSocket()</code> <code>EventSource()</code> <code>sendBeacon()</code> <code>fetch()</code>
<ul>
<li>ajax連外部.json檔要改這一個</li>
<li>websocket</li>
</ul>
</li>
<li><code>block-all-mixed-content;</code> - 禁止https/http混合內容</li>
<li><code>upgrade-insecure-requests;</code> - 強制將網頁內容中所有<code>http://</code>請求升級成<code>https://</code>
<ul>
<li>若請求來源不支援<code>https://</code>不會降級回<code>http://</code>,而是請求失敗</li>
<li>這個語法不能讓網頁本身的<code>http://</code>轉跳到<code>https://</code>,若要轉跳要用<code>Strict-Transport-Security</code>
<ul>
<li>參考資料: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" target="_blank" rel="noopener">Strict-Transport-Security - HTTP | MDN</a></li>
<li><code>Strict-Transport-Security</code>是獨立的HTTP header,不在CSP範圍內</li>
<li><code>Strict-Transport-Security</code>是瀏覽器層級的轉跳</li>
<li>要從伺服端層級轉跳請找<code>301 redirect</code>重新定向語法</li>
</ul>
</li>
</ul>
</li>
<li><code>require-sri-for</code> - 強制外部引入的<code>script</code>或<code>style</code>必須使用SRI驗證內容完整性
<ul>
<li>語法:
<ul>
<li><code>Content-Security-Policy: require-sri-for script;</code></li>
<li><code>Content-Security-Policy: require-sri-for style;</code></li>
<li><code>Content-Security-Policy: require-sri-for script style;</code></li>
</ul>
</li>
<li>參考資料:
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/require-sri-for" target="_blank" rel="noopener">CSP: require-sri-for - HTTP | MDN</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener">Subresource Integrity (SRI) - Web security | MDN</a></li>
</ul>
</li>
</ul>
</li>
<li><code>report-uri</code> - 當用戶端違反CSP時,回傳給server的接收網址(HTTP POST json格式)
<ul>
<li>這個功能將被棄用,要改成<code>report-to</code>(但是大多瀏覽器還不支援)</li>
</ul>
</li>
</ul>
<h2 id="語法-syntax"><a class="header-anchor" href="#語法-syntax"></a>語法 Syntax</h2>
<p>CSP以<strong>白名單</strong>的形式運作<br>
建議以 <code>default-src 'none';</code> 或是 <code>default-src 'self';</code><br>
當成起頭再來設定細部選項,以提高安全性<br>
若沒設定到時會自動採用default-src的設定值,避免遺漏</p>
<ul>
<li><code>'none'</code> - 全部不允許</li>
<li><code>'self'</code> - 允許同網域</li>
<li><code>指定網域</code> &lt; host-source &gt; - 指定允許的網域,以空格分開
<ul>
<li>包含或不包含<code>http://</code>,<code>https://</code>前綴的網址,可加<code>*</code>萬用字元</li>
<li><code>example.com</code></li>
<li><code>*.example.com</code></li>
<li><code>https://example.com</code></li>
<li><code>https://*.example.com</code></li>
<li><code>wss://example.com</code> - 測試過<code>wss://</code>前綴不能省略一定要加</li>
<li><code>wss://*.example.com</code></li>
</ul>
</li>
<li>&lt; scheme-source &gt;
<ul>
<li><code>http:</code></li>
<li><code>https:</code></li>
<li><code>data:</code></li>
<li><code>mediastream:</code></li>
<li><code>blob:</code></li>
<li><code>filesystem:</code></li>
</ul>
</li>
<li><code>*</code> - 全部允許(儘量不要用)</li>
<li><code>'unsafe-inline'</code> - 允許html行內css或js
<ul>
<li>最常出現XSS攻擊語法的地方就是inline,所以建議將自有的JS,CSS語法全寫成獨立檔案,最好能不要開啟這個權限</li>
</ul>
</li>
<li><code>'unsafe-eval'</code> - 允許<code>eval()</code>
<ul>
<li><code>eval()</code>是將字串重新轉回成可執行的程式碼,本身就是高風險的語法,不建議開啟權限</li>
</ul>
</li>
<li><code>'nonce-&lt;base64-value&gt;'</code></li>
<li><code>'&lt;hash-algorithm&gt;-&lt;base64-value&gt;'</code></li>
</ul>
<p>最後兩個驗證碼比對用法請參考: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src" target="_blank" rel="noopener">CSP: script-src - HTTP | MDN</a></p>
<h2 id="常用白名單範例-以apache-htaccess寫法為例"><a class="header-anchor" href="#常用白名單範例-以apache-htaccess寫法為例"></a>常用白名單範例(以Apache .htaccess寫法為例)</h2>
<ul>
<li>常用的外部網站檔案用英文關鍵字丟Google都會有人寫過,不會寫的話可以用Google找比較快(通常寫法也會比自己寫的完整)</li>
</ul>
<h3 id="google-analytics"><a class="header-anchor" href="#google-analytics"></a>Google Analytics</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> set Content-Security-Policy <span class="string">" \</span></span><br><span class="line"><span class="string">    default-src 'self'; \</span></span><br><span class="line"><span class="string">    script-src 'self' https://www.google-analytics.com https://www.googletagmanager.com; \</span></span><br><span class="line"><span class="string">    img-src 'self' data: https://www.google-analytics.com; \</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="google-cnd-jquery之類的cdn外連-js"><a class="header-anchor" href="#google-cnd-jquery之類的cdn外連-js"></a>Google CND (jQuery之類的CDN外連.js)</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> set Content-Security-Policy <span class="string">" \</span></span><br><span class="line"><span class="string">    default-src 'self'; \</span></span><br><span class="line"><span class="string">    script-src 'self' https://ajax.googleapis.com; \</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="youtube"><a class="header-anchor" href="#youtube"></a>Youtube</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> set Content-Security-Policy <span class="string">" \</span></span><br><span class="line"><span class="string">    default-src 'self'; \</span></span><br><span class="line"><span class="string">    frame-src 'self' https://www.youtube.com; \</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/vtwiz6P1rdw&quot; frameborder=&quot;0&quot; allow=&quot;autoplay; encrypted-media&quot; allowfullscreen&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<h3 id="obs-studio-browser-source"><a class="header-anchor" href="#obs-studio-browser-source"></a>OBS Studio (Browser Source)</h3>
<p>如果你的網頁有要嵌入OBS中,記得要加<code>data:</code>才能修改自訂CSS</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Header</span></span> set Content-Security-Policy <span class="string">" \</span></span><br><span class="line"><span class="string">    default-src 'self'; \</span></span><br><span class="line"><span class="string">    style-src 'self' 'unsafe-inline' data:; \</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="其他csp以外的安全性設定"><a class="header-anchor" href="#其他csp以外的安全性設定"></a>其他CSP以外的安全性設定</h2>
<h3 id="referrer-policy"><a class="header-anchor" href="#referrer-policy"></a>Referrer-Policy</h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy" target="_blank" rel="noopener">Referrer-Policy - HTTP | MDN</a> (使用細節請看MDN內文)</p>
<ul>
<li>一個網頁中點選網址或嵌入圖片(所有外部來源<code>&lt;a&gt;</code>, <code>&lt;area&gt;</code>, <code>&lt;img&gt;</code>, or <code>&lt;link&gt;</code> )都會送出Referrer(來源網址)
<ul>
<li>網頁流量分析就是靠這個Referrer來取得來源網址
<ul>
<li>像是Google搜尋完點選網址到<strong>目標網頁</strong>就會送出完整的Referrer,所以<strong>目標網頁</strong>的流量分析工具就能知道這個用戶是用Google搜尋進來的,而且搜了什麼關鍵字都知道(因為關鍵字有在網址參數上面)</li>
</ul>
</li>
</ul>
</li>
<li>所以這個功能主要是可以增加用戶隱私,限制Referrer送出的方式,避免來源網址被第三方網站取得來源網址
<ul>
<li>舉例來說像是社群網站的網址都帶有使用者ID,這個功能就能有效限制用戶ID來源被第三方網站取得,對於增加用戶隱私有很大的幫助</li>
</ul>
</li>
<li>避免內部機密網址(或是沒有完全對外公開的測試網站)被第三方網站取得網址
<ul>
<li><strong>真的有機密的東西就不要放在公開網路上</strong></li>
</ul>
</li>
<li>最嚴格的<code>no-referrer</code>可能會影響自己網站本身的流量分析和廣告運作(如果有放的話),所以還是要看狀況調整成就適合自己網站使用的參數</li>
<li><code>no-referrer</code>不能阻止Javascript的AJAX請求送出referrer</li>
</ul>
<h3 id="csp以外增加安全性的header-以apache-htaccess寫法為例"><a class="header-anchor" href="#csp以外增加安全性的header-以apache-htaccess寫法為例"></a>CSP以外增加安全性的Header(以Apache .htaccess寫法為例)</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =========== Header ===========</span></span><br><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line">    <span class="comment"># 唯有當符合同源政策下，才能被嵌入到 frame 中。(防止網站被外部釣魚網站嵌入)</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> always append X-Frame-Options SAMEORIGIN</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 拒絕 MIME 類型錯誤的回應 (js,css)</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> set X-Content-Type-Options <span class="string">"nosniff"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 將所有Cookie設為HttpOnly</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> always edit Set-Cookie (.*) <span class="string">"$1; HTTPOnly; Secure"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#隱藏PHP版本</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> always unset X-Powered-By</span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># ==============================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========= 禁止訪問檔案 =========</span></span><br><span class="line"><span class="comment"># 這些檔案不應該放在外部網路能讀取到的地方</span></span><br><span class="line"><span class="comment"># 如果你還是上傳了這些檔案請把他給擋掉外部讀取</span></span><br><span class="line"><span class="comment"># 不然這會很危險</span></span><br><span class="line"><span class="comment"># .git可以把你所有程式碼還原</span></span><br><span class="line"><span class="comment"># composer.json, package.json可以知道你用了哪些package和版本</span></span><br><span class="line"><span class="comment"># 如果你用了舊版本沒更新,可能就會被找到漏洞</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">RedirectMatch</span> 404 /\.git</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Files composer.json&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files composer.lock&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files .gitignore&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files .htacces&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files .htaccess.sample&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files .php_cs&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files .travis.yml&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files CHANGELOG.md&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files CONTRIBUTING.md&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files CONTRIBUTOR_LICENSE_AGREEMENT.html&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files COPYING.txt&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files Gruntfile.js&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files LICENSE.txt&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files LICENSE_AFL.txt&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files nginx.conf.sample&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files package.json&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files php.ini.sample&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="section">&lt;Files README.md&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">order</span></span> allow,deny</span><br><span class="line">	<span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br><span class="line"><span class="comment"># ===============================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========隱藏目錄下所有檔案========</span></span><br><span class="line"><span class="section">&lt;IfModule mod_autoindex.c&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> -Indexes</span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># ===============================</span></span><br></pre></td></tr></table></figure>
<h3 id="防止cdn來源的檔案被cdn業者篡改-subresource-integrity-sri"><a class="header-anchor" href="#防止cdn來源的檔案被cdn業者篡改-subresource-integrity-sri"></a>防止CDN來源的檔案被CDN業者篡改 (Subresource Integrity (SRI))</h3>
<p>這個功能在<a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a>官網就能看到實例<br>
利用<code>integrity</code>中的雜湊碼來檢查檔案是否被偷改過<br>
相同的檔案雜湊碼每次算出來都會一樣<br>
被偷改過的檔案雜湊碼則會不同(即使只改一個字雜湊碼也會完全不一樣)<br>
雜湊碼不同時則檔案不會載入運行(更嚴謹的講法是會載入但不會運行,因為要有完整檔案才能給瀏覽器算雜湊碼)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css&quot; integrity=&quot;sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4&quot; crossorigin=&quot;anonymous&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot; integrity=&quot;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js&quot; integrity=&quot;sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js&quot; integrity=&quot;sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>參考資料: <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener">Subresource Integrity (SRI) - Web security | MDN</a></li>
</ul>
<h4 id="使用openssl指令取得雜湊碼"><a class="header-anchor" href="#使用openssl指令取得雜湊碼"></a>使用OpenSSL指令取得雜湊碼:</h4>
<p>windows環境下可以直接用git附送的bash來輸入以下指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat dist/main.js | openssl dgst -sha256 -binary | openssl base64 -A</span><br><span class="line">cat dist/main.js | openssl dgst -sha384 -binary | openssl base64 -A</span><br><span class="line">cat dist/main.js | openssl dgst -sha512 -binary | openssl base64 -A</span><br></pre></td></tr></table></figure>
<h4 id="使用php取得雜湊碼"><a class="header-anchor" href="#使用php取得雜湊碼"></a>使用PHP取得雜湊碼:</h4>
<p>這篇是舉例用,建議實機上線不要這樣寫<br>
應該把雜湊結果存起來直接寫在網頁裡<br>
而不是每次連入都算一次,因為這樣會很浪費伺服器CPU運算</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">openssl指令:</span></span><br><span class="line"><span class="comment">(windows環境下可以直接用git附送的bash來輸入以下指令)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">cat dist/main.js | openssl dgst -sha256 -binary | openssl base64 -A</span></span><br><span class="line"><span class="comment">cat dist/main.js | openssl dgst -sha384 -binary | openssl base64 -A</span></span><br><span class="line"><span class="comment">cat dist/main.js | openssl dgst -sha512 -binary | openssl base64 -A</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">列出php支援的算法</span></span><br><span class="line"><span class="comment">https://www.php.net/manual/zh/function.openssl-get-md-methods.php</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//print_r(openssl_get_md_methods(true));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$file = <span class="string">'dist/main.js'</span>;</span><br><span class="line"></span><br><span class="line">$file_contents = file_get_contents($file);</span><br><span class="line"></span><br><span class="line"><span class="comment">//留一個你要用的算法就好</span></span><br><span class="line">$sha256 = <span class="string">'sha256-'</span> . base64_encode( openssl_digest($file_contents , <span class="string">'sha256'</span>, <span class="keyword">TRUE</span>) );</span><br><span class="line">$sha384 = <span class="string">'sha384-'</span> . base64_encode( openssl_digest($file_contents , <span class="string">'sha384'</span>, <span class="keyword">TRUE</span>) );</span><br><span class="line">$sha512 = <span class="string">'sha512-'</span> . base64_encode( openssl_digest($file_contents , <span class="string">'sha512'</span>, <span class="keyword">TRUE</span>) );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--留一個你要用的算法就好--&gt;</span><br><span class="line">&lt;script src=<span class="string">"&lt;?php echo $file; ?&gt;"</span> integrity=<span class="string">"&lt;?php echo $sha256; ?&gt;"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"&lt;?php echo $file; ?&gt;"</span> integrity=<span class="string">"&lt;?php echo $sha384; ?&gt;"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"&lt;?php echo $file; ?&gt;"</span> integrity=<span class="string">"&lt;?php echo $sha512; ?&gt;"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="防止點網址開新視窗時原網頁被切換篡改-noopener"><a class="header-anchor" href="#防止點網址開新視窗時原網頁被切換篡改-noopener"></a>防止點網址開新視窗時原網頁被切換篡改 (noopener)</h3>
<p>白話講就是在A網頁點開B網頁連結的分頁<br>
這時如果B網頁如果帶有惡意JS語法,那他可以把A網頁導到其他頁面<br>
假設像是A網頁如果是fb,如果被導到假的fb登入頁面就可能會被騙走帳號密碼<br>
這個連結寫法可以防止這個問題產生(細節原理請自行google)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; href=&quot;http://example.com/&quot;&gt;連結&lt;/a&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://eotones.github.io/Web-security/Content-Security-Policy-CSP.html" data-id="cjyr3fdst0006vgfbnuinwiru" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP-Header/">HTTP Header</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Security/">Security</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/Hexo/test-post.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">test post</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分類</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web-security/">Web security</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-Header/">HTTP Header</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/">Security</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTTP-Header/" style="font-size: 10px;">HTTP Header</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Web-security/Content-Security-Policy-CSP.html">Content Security Policy (CSP) 筆記</a>
          </li>
        
          <li>
            <a href="/Hexo/test-post.html">test post</a>
          </li>
        
          <li>
            <a href="/Hexo/hello-world.html">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 EOTONES<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>